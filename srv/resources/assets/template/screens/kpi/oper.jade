include _table
include _settings

.row-fluid
  .span12.default-bs
    include _statNav
    .row-fluid#settings
      +settingsContainer
        .row-fluid
          .span6
            +settings
          .span6
            span.inverse-red Выделять красным
            | , если занят &ge;
            input.tiny-input(type="text"
                data-bind="value: overdue, update: 'afterkeydown'")
            | минут
            br
            span.inverse-orange Выделять оранжевым
            | , если разлогинился из статуса занят

            br
            label.checkbox
              input(type="checkbox" data-bind="checked: hideOffline")
              | Скрывать в статусе "Разлогинен"
      .row-fluid#filters(style="margin-top: 10px")
        .span4#kvmsFilter
          +kvmFilter
        +downloadTbl

    .row-fluid#results(style="overflow-y: auto")
      table#tbl.table.table-striped.table-bordered
       thead
         tr
           // ko foreach: fields
           th(data-bind="visible: show")
             button.btn.btn-link(
               style='white-space: nowrap;'
               data-bind='text: label, sort: name')
           // /ko
       tbody(data-bind="foreach: {data: kvms, as: 'kvm'}")
         tr(data-bind="visible: !(kvm.currentState() == 'LoggedOut' && \
                                  $root.hideOffline())")
           // ko foreach: $root.fields
           td(data-bind="visible: show, \n\
                         render: {kvm: kvm, field: $data}, \n\
                         css: { 'inverse-orange': kvm.lastState() == 'Bysy' &&  \
                                           kvm.currentState() == 'LoggedOut', \n\
                                'inverse-red': kvm.currentState() == 'Busy' && \
                                               kvm.inCurrent() > $root.overdue()}")
           // /ko

.hidden
  include /fields/ro.jade