mixin fieldControlGroup
  .form-group.has-feedback(data-bind="\n\
                            {{# meta.required }}\n\
                            css: { error: {{name}}Not }\n\
                            {{/ meta.required}}\n\
                            {{# meta.visibility }}\n\
                            visible: {{name}}Visible\n\
                            {{/ meta.visibility}}")
    label.col-sm-4.control-label
      | {{ meta.label }}
      +labelAnnotations("{{name}}")(style="position: absolute; right: -5px;")
    .col-sm-8
      .input-group.input-group-sm
        block

mixin defaultInput(nameMod, dataBinds, change, attrs)
  input.form-control(type="text" autocomplete="off"
    name="{{ name }}"
    style="{{# meta.transform }}\n\
           text-transform:{{meta.transform}};\n\
           {{/ meta.transform }}"
    data-bind="\n\
               value: {{ name }}#{nameMod},\n\
               valueUpdate: ['#{change}', 'afterpaste'],\n\
               readonly: {{ name }}Disabled,\n\
               {{# meta.regexp }}\n\
               css: { 're-failed': {{name}}Regexp },\n\
               {{/ meta.regexp}}\n\
               #{dataBinds}"
    )&attributes(attributes)
  +savingSpinner

mixin savingSpinner
  span.glyphicon.glyphicon-refresh.glyphicon-refresh-animate.form-control-feedback(
    data-bind='sync: {{ name }}Sync' style='display: none;')

mixin labelAnnotations(name)
  span(data-bind="visible: #{name}.field.meta.infoText1")&attributes(attributes)
    span.glyphicon.glyphicon-question-sign(data-provide="popover"
      data-bind="attr: { 'data-content': #{name}.field.meta.infoText1")

mixin dictInput(nameMod)
  input.form-control( type="text"
     class="{{# meta.addClass }}{{meta.addClass}}{{/ meta.addClass }}"
     autocomplete="off"
     name="{{ name }}"
     data-bind="\n\
                value: {{ name }}#{nameMod},\n\
                valueUpdate: 'change',\n\
                disabled: {{ name }}Disabled,\n\
                pickerDisable: {{ name }}Disabled,\n\
                bindDict: '{{ name }}',\n\
                {{# meta.regexp   }}\n\
                css: { 're-failed': {{name}}Regexp }\n\
                {{/ meta.regexp   }}")

mixin dict(nameMod, iconClass)
  +fieldControlGroup

    +dictInput(nameMod)

    span.input-group-addon
      span.glyphicon.glyphicon-chevron-down
    +savingSpinner
    block

mixin checkboxInput(name)
  input(type="checkbox"
        data-bind="attr: { name: #{name} }, \
                   checked: #{name},        \
                   valueUpdate: 'change',   \
                   disabled: #{name}.disabled")&attributes(attributes)

mixin checkboxLabel(name)
  span(data-bind="text: #{name}.field.meta.label")&attributes(attributes)
  +labelAnnotations(name)(style="position: absolute; right: -5px;")

mixin checkboxTpl(name)
  .form-group
    label.col-sm-4.control-label
      +checkboxLabel(name)

    .col-sm-8
      +checkboxInput(name)
