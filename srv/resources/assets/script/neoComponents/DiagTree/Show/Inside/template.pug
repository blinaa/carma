- var pfx = 'diag-tree-show'

mixin answer(disabled)
  div(data-bind='if: item.get("answerIx") !== null')
    div(class=`${pfx}--history-answer`)
      span(data-bind='\
        text: item.getIn(["answers", item.get("answerIx"), "header"]),\
      ')
      br
      span(data-bind='text: item.get("answerTime")')
      span= ' - '
      span(data-bind='text: item.get("answeredBy")')

    // TODO do it different way
    unless disabled
      span.btn.glyphicon.glyphicon-repeat(
        class=`${pfx}--floating-btn`
        title='Повторить вопрос'
        data-action='repeat-question'
        data-bind='visible: $component.hoverId() === item.get("id")')

mixin historyItem
  div
    a(
      href='#'
      class=`${pfx}--more`
      data-bind='\
        visible: \
          $component.hasPrevHistory(item.get("id")) &&\
          $component.showDeprecated() !== item.get("id"),\
        click: $component.showDeprecatedAnswers,\
      ')
      | Показать отменённые ответы

    a(
      href='#'
      class=`${pfx}--more`
      data-bind='\
        visible: $component.showDeprecated() === item.get("id"),\
        click: $component.hideDeprecatedAnswers,\
      ')
      | Скрыть отменённые ответы

  //
    ko if:
      $component.hasPrevHistory(item.get("id")) &&
      $component.showDeprecated() === item.get("id")

  .list-group(data-bind='\
    foreach: {\
      data: $component.prevHistory(item.get("id")).toArray(),\
      as: "prevItem",\
    },\
  ')
    button.list-group-item(
      class=`${pfx}--deprecated`
      data-bind=`\
        css: {"${pfx}--selected": prevItem.get("id") === $component.slideId()},\
        click: $component.selectHistory,\
      `)
        h4.list-group-item-heading(data-bind='text: prevItem.get("header")')
        p.list-group-item-text
          +answer(true)

  // /ko

  button.list-group-item(data-bind=`\
    css: {"${pfx}--selected": $component.slideId() === item.get("id")},\
    click: $component.selectHistory,\
    event: {\
      mouseenter: $component.onHistoryMouseEnter,\
      mouseleave: $component.onHistoryMouseLeave,\
    },\
  `)
    h4.list-group-item-heading(data-bind='text: item.get("header")')
    p.list-group-item-text
      +answer(false)

.container
  .row
    .col-md-4
      .list-group(data-bind='\
        foreach: {data: $component.history, as: "item"},\
      ')
        div
          +historyItem
    .col-md-8
      h1(data-bind='text: $component.slideHeader')
